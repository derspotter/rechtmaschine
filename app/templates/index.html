<!DOCTYPE html>
<html>

<head>
    <title>Rechtmaschine - Document Classifier</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>

<body>
    <div id="loginOverlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 8px; width: 300px; text-align: center;">
            <h2>Anmelden</h2>
            <input type="email" id="loginEmail" placeholder="E-Mail"
                style="width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box;">
            <input type="password" id="loginPassword" placeholder="Passwort"
                style="width: 100%; padding: 10px; margin-bottom: 20px; box-sizing: border-box;">
            <button class="btn" onclick="handleLogin()"
                style="width: 100%; background-color: #27ae60;">Einloggen</button>
            <p id="loginError" style="color: red; margin-top: 10px; display: none;"></p>
        </div>
    </div>

    <div class="header">
        <h1>üèõÔ∏è Rechtmaschine</h1>

        <div class="header-bar">
            <div class="legal-area-toggle">
                <span class="legal-area-label">Rechtsgebiet:</span>
                <span id="legalAreaLabelMigrations" class="legal-area-option" role="button" tabindex="0">Migrationsrecht</span>
                <label class="switch">
                    <input type="checkbox" id="legalAreaToggle" aria-label="Sozialrecht aktivieren">
                    <span class="slider"></span>
                </label>
                <span id="legalAreaLabelSozial" class="legal-area-option" role="button" tabindex="0">Sozialrecht</span>
            </div>

            <div class="header-controls">
                <div class="case-controls">
                    <span class="case-label">Fall:</span>
                    <select id="caseSelect" class="case-select" onchange="handleCaseSelectChange(this)">
                    </select>
                    <button class="btn btn-small" onclick="renameCurrentCase()" title="Aktuellen Fall umbenennen">
                        ‚úèÔ∏è Umbenennen
                    </button>
                    <button class="btn btn-small btn-success" data-new-case-button onclick="createNewCaseFlow(event)">
                        üÜï Neuer Fall
                    </button>
                </div>

                <!-- Keep the hard reset available but out of the main workflow -->
                <button class="btn btn-danger" data-reset-button onclick="resetApplication(event)" style="display: none;">
                    üßπ Alles zur√ºcksetzen
                </button>
            </div>
        </div>
    </div>

    <div class="categories-grid" style="margin-bottom: 30px;">
        <!-- Box 1: Dokument befragen (Ersatz f√ºr Klassifikation) -->
        <!--
        <div class="category-box classify">
            <div class="category-header">
                <h3 style="margin: 0;">üì§ Klassifikation</h3>
            </div>
            <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 15px;">
                Laden Sie ein PDF-Dokument hoch, um es zu analysieren und automatisch einzuordnen.
            </p>
            <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff,.bmp" style="width: 100%; margin-bottom: 15px;" />
            <button class="btn" onclick="uploadFile()" style="width: 100%; background-color: #16a085;">Dokument
                klassifizieren</button>
            <div class="loading" id="loading">‚è≥ Dokument wird analysiert...</div>
        </div>
        -->
        <div class="category-box query-box">
            <div class="category-header">
                <h3 style="margin: 0;">‚ùì Dokument befragen</h3>
            </div>
            <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 15px;">
                Stellen Sie Fragen zu den ausgew√§hlten Dokumenten (Gemini 3 Flash).
            </p>

            <textarea id="queryInput" placeholder="Ihre Frage an die Dokumente..."
                style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #bdc3c7; border-radius: 5px; font-family: Arial; margin-bottom: 10px; resize: vertical;"></textarea>

            <button class="btn" onclick="queryGemini()" style="width: 100%; background-color: #8e44ad;">
                Fragen (Gemini 3 Flash)
            </button>

            <div id="queryAnswerResult" style="margin-top: 15px; display: none;">
                <div id="queryLoading" style="display: none; color: #7f8c8d; margin-bottom:10px;">‚è≥ Denke nach...</div>
                <div id="queryAnswerText" class="markdown-content"
                    style="background: #fff; padding: 15px; border-radius: 5px; border: 1px solid #ddd; max-height: 400px; overflow-y: auto;">
                </div>
            </div>
        </div>

        <!-- Box 2: Recherche -->
        <div class="category-box research-box">
            <div class="category-header">
                <h3 style="margin: 0;">üîç Recherche</h3>
            </div>
            <textarea id="outputDescription" placeholder="Frage eingeben (z.B. 'Abschiebungsverbot Afghanistan')"
                style="width: 100%; min-height: 80px; padding: 10px; border: 1px solid #bdc3c7; border-radius: 5px; font-family: Arial; margin-bottom: 10px; resize: vertical;"></textarea>

            <div style="margin-bottom: 10px;">
                <label for="asylnetKeywords" style="font-weight: 600; color: #2c3e50; font-size: 13px;">asyl.net Suche
                    (Optional):</label>
                <input type="text" id="asylnetKeywords" list="asylnetSuggestions"
                    placeholder="Schlagw√∂rter (z.B. Syrien)"
                    style="width: 100%; padding: 6px 10px; border: 1px solid #bdc3c7; border-radius: 5px; margin-top: 2px;">
                <datalist id="asylnetSuggestions"></datalist>
            </div>



            <div style="margin-bottom: 15px;">
                <label for="searchEngineSelect"
                    style="font-weight: 600; color: #2c3e50; font-size: 13px;">Suchmaschine:</label>
                <select id="searchEngineSelect"
                    style="width: 100%; padding: 6px; border: 1px solid #bdc3c7; border-radius: 5px; margin-top: 2px;">
                    <option value="meta" selected>‚ú® Meta-Suche (Smart Aggregation)</option>
                    <option value="gemini">Gemini (Standard)</option>
                    <option value="grok-4-1-fast">Grok 4.1 Fast</option>
                </select>
            </div>

            <button class="btn" onclick="generateDocument()" style="background-color: #c0392b; width: 100%;">
                Recherche starten
            </button>
            <div class="loading" id="researchLoading">‚è≥ Recherche l√§uft...</div>
        </div>

        <!-- Box 3: Generierung -->
        <div class="category-box generate">
            <div class="category-header">
                <h3 style="margin: 0;">‚úçÔ∏è Entwurf</h3>
            </div>

            <div style="margin-bottom: 10px;">
                <label for="documentTypeSelect"
                    style="font-weight: 600; color: #2c3e50; font-size: 13px;">Dokumententyp:</label>
                <select id="documentTypeSelect"
                    style="width: 100%; padding: 6px; border: 1px solid #bdc3c7; border-radius: 5px; margin-top: 2px;">
                    <option value="Klagebegr√ºndung">Klagebegr√ºndung</option>
                    <option value="Antrag auf Zulassung der Berufung (AZB)">Antrag auf Zulassung der Berufung (AZB)
                    </option>
                    <option value="Schriftsatz">Schriftsatz</option>
                </select>
            </div>

            <div style="margin-bottom: 10px;">
                <label for="draftInstructions"
                    style="font-weight: 600; color: #2c3e50; font-size: 13px;">Anweisungen:</label>
                <textarea id="draftInstructions"
                    placeholder="Spezifische Anweisungen f√ºr den Entwurf (z.B. 'Fokus auf PTSD', 'Mandant ist minderj√§hrig')"
                    style="width: 100%; min-height: 80px; padding: 10px; border: 1px solid #bdc3c7; border-radius: 5px; font-family: Arial; margin-top: 2px; resize: vertical;"></textarea>
            </div>

            <div style="margin-bottom: 10px;">
                <label for="modelSelect" style="font-weight: 600; color: #2c3e50; font-size: 13px;">KI-Modell:</label>
                <select id="modelSelect"
                    style="width: 100%; padding: 6px; border: 1px solid #bdc3c7; border-radius: 5px; margin-top: 2px;">
                    <option value="claude-opus-4-5" selected>Claude Opus 4.5</option>
                    <option value="gpt-5.2">GPT-5.2 (Reasoning)</option>
                    <option value="gemini-3-pro-preview">Gemini 3 Pro</option>
                    <option value="multi-step-expert">Multi-Step Expert</option>
                </select>
            </div>

            <div id="verbosityGroup" style="display: none; margin-bottom: 15px;">
                <label for="verbositySelect"
                    style="font-weight: 600; color: #2c3e50; font-size: 13px;">Ausf√ºhrlichkeit:</label>
                <select id="verbositySelect"
                    style="width: 100%; padding: 6px; border: 1px solid #bdc3c7; border-radius: 5px; margin-top: 2px;">
                    <option value="high" selected>High (Sehr ausf√ºhrlich)</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
            </div>

            <button class="btn" onclick="createDraft()"
                style="background-color: #2c3e50; width: 100%; margin-top: 10px;">
                Entwurf generieren
            </button>
            <div style="text-align: right; margin-top: 8px;">
                <button onclick="toggleDraftHistory()"
                    style="background: none; border: none; font-size: 13px; color: #7f8c8d; text-decoration: underline; cursor: pointer;">
                    Verlauf anzeigen
                </button>
            </div>
            <div id="draftHistoryContainer"
                style="display: none; margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #2c3e50;">Verlauf</h4>
                <div id="draftHistoryList" style="max-height: 200px; overflow-y: auto;">
                    <!-- Draft items will be injected here -->
                    <div style="font-size: 12px; color: #95a5a6;">Laden...</div>
                </div>
            </div>
        </div>
    </div>

    <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Dokumente</h2>
    <div class="categories-grid">
        <div class="category-box anhoerung">
            <div class="category-header">
                <h3>üìã Anh√∂rung</h3>
                <button class="btn-add-doc" onclick="triggerDirectUpload('Anh√∂rung')"
                    title="Dokument direkt hochladen">+</button>
                <input type="file" id="file-anhoerung" accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff,.bmp" style="display: none;"
                    onchange="uploadDirectFile('Anh√∂rung', this)">
            </div>
            <div id="anhoerung-docs"></div>
        </div>
        <div class="category-box bescheid">
            <div class="category-header">
                <h3>üìÑ Bescheid</h3>
                <button class="btn-add-doc" onclick="triggerDirectUpload('Bescheid')"
                    title="Dokument direkt hochladen">+</button>
                <input type="file" id="file-bescheid" accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff,.bmp" style="display: none;"
                    onchange="uploadDirectFile('Bescheid', this)">
            </div>
            <div id="bescheid-docs"></div>
        </div>
        <div class="category-box vorinstanz">
            <div class="category-header">
                <h3>üèõÔ∏è Vorinstanz</h3>
                <button class="btn-add-doc" onclick="triggerDirectUpload('Vorinstanz')"
                    title="Dokument direkt hochladen">+</button>
                <input type="file" id="file-vorinstanz" accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff,.bmp" multiple style="display: none;"
                    onchange="uploadDirectFile('Vorinstanz', this)">
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 8px; padding-right: 10px;">
                <button class="btn" onclick="selectAllVorinstanz()"
                    style="padding: 4px 8px; font-size: 11px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">‚úÖ
                    Alle ausw√§hlen</button>
            </div>
            <div id="vorinstanz-docs"></div>
        </div>
        <div class="category-box akte">
            <div class="category-header">
                <h3>üìö Akte</h3>
                <button class="btn-add-doc" onclick="triggerDirectUpload('Akte')"
                    title="Dokument direkt hochladen">+</button>
                <input type="file" id="file-akte" accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff,.bmp" style="display: none;"
                    onchange="uploadDirectFile('Akte', this)">
            </div>
            <div id="akte-docs"></div>
        </div>
        <div class="category-box rechtsprechung">
            <div class="category-header">
                <h3>‚öñÔ∏è Rechtsprechung</h3>
                <button class="btn-add-doc" onclick="triggerDirectUpload('Rechtsprechung')"
                    title="Dokument direkt hochladen">+</button>
                <input type="file" id="file-rechtsprechung" accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff,.bmp" style="display: none;"
                    onchange="uploadDirectFile('Rechtsprechung', this)">
            </div>
            <div class="rechtsprechung-tabs">
                <button class="rechtsprechung-tab active" data-target="rechtsprechung-docs">Dokumente</button>
                <button class="rechtsprechung-tab" data-target="rechtsprechung-playbook">Aktuelle Rechtsprechung</button>
            </div>
            <div id="rechtsprechung-docs"></div>
            <div id="rechtsprechung-playbook" style="display: none;">
                <div class="playbook-filters">
                    <select id="playbookCountryFilter">
                        <option value="">Alle L√§nder</option>
                    </select>
                    <input type="text" id="playbookTagFilter" placeholder="Tag filtern (optional)">
                    <button class="btn btn-small" id="playbookRefreshBtn">Aktualisieren</button>
                </div>
                <div id="playbookEntries"></div>
            </div>
        </div>
        <div class="category-box sonstiges">
            <div class="category-header">
                <h3>üìÇ Sonstige gespeicherte Quellen</h3>
                <button class="btn-add-doc" onclick="triggerDirectUpload('Sonstiges')"
                    title="Dokument direkt hochladen">+</button>
                <input type="file" id="file-sonstiges" accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff,.bmp" style="display: none;"
                    onchange="uploadDirectFile('Sonstiges', this)">
            </div>
            <!-- Unified container for both documents and saved sources -->
            <div id="sonstiges-docs"></div>
        </div>
    </div>

    <script src="/static/js/marked.min.js"></script>
    <script src="/static/js/drafts.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>
